#!/usr/bin/env bash
SOURCE="${BASH_SOURCE[0]}"
while [ -h "$SOURCE" ]; do
  DIR="$(cd -P "$(dirname "$SOURCE")" && pwd)"
  SOURCE="$(readlink "$SOURCE")"
  if [[ "$SOURCE" != /* ]]; then
    SOURCE="$DIR/$SOURCE"
  fi
done
DIR="$(cd -P "$(dirname "$SOURCE")" && pwd)"
ROOT_DIR="$(cd -P "$DIR/.." && pwd)"
if ! node -e 'import("tsx").then(() => process.exit(0)).catch(() => process.exit(1))' >/dev/null 2>&1; then
  echo "xcode-mcp: missing runtime dependency 'tsx'" >&2
  echo "Reinstall package dependencies (npm install) or reinstall xcode-mcp-bridge." >&2
  exit 1
fi

exec node --import tsx "$ROOT_DIR/src/xcode.ts" "$@"
